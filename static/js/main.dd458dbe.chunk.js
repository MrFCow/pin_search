(this.webpackJsonppinterest_search=this.webpackJsonppinterest_search||[]).push([[0],{331:function(e,t,n){},363:function(e,t){},364:function(e,t){},372:function(e,t){},375:function(e,t){},376:function(e,t){},397:function(e,t,n){"use strict";n.r(t);var a=n(33),r=n(20),c=n.n(r),o=n(118),i=n.n(o),s=(n(331),n(4)),u=n.n(s),d=n(11),l=n(5),h=n(217),j=n.n(h),b=n(416),m=n(418),g=n(414),f=n(415),p=n(417),O=n(419),x=j()((function(e){return{root:{maxWidth:345},media:{height:0,paddingTop:"56.25%"},backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"}}}));function v(e){var t=x(),n=Object(r.useState)(!1),c=Object(l.a)(n,2),o=c[0],i=c[1];return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("img",{src:e.item.image_square_url,alt:"",onClick:function(){i(!o)}}),Object(a.jsx)(p.a,{className:t.backdrop,open:o,onClick:function(){i(!1)},children:Object(a.jsxs)(m.a,{className:t.root,children:[Object(a.jsx)(g.a,{component:"img",image:e.item.image_large_url}),Object(a.jsxs)(f.a,{children:[Object(a.jsx)(b.a,{children:e.item.description}),Object(a.jsx)(b.a,{children:e.item.domain}),Object(a.jsx)(O.a,{href:e.item.link,children:e.item.link})]})]})})]})}var w=j()((function(e){return{root:{display:"flex",flexWrap:"wrap",overflow:"hidden",backgroundColor:e.palette.background.paper}}}));function y(e){var t=w();return Object(a.jsx)("div",{className:t.root,children:e.data.map((function(e){return Object(a.jsx)(v,{item:e},e.id)}))})}var k=n(119),S=n(302),C=n(301),M=n(402),I=Object(M.a)({root:{width:300,position:"relative",backgroundColor:"rgb(0,0,0,0.5)",marginLeft:50},box:{position:"absolute",backgroundColor:"rgba(0,155,0,0.5)"},img:{"-webkit-user-drag":"none","-khtml-user-drag":"none","-moz-user-drag":"none","-o-user-drag":"none","user-drag":"none",maxWidth:300}});function _(e){var t=I(),n=Object(C.a)(),c=Object(l.a)(n,2),o=c[0],i=c[1],s=Object(r.useState)({startX:0,startY:0,endX:0,endY:0}),u=Object(l.a)(s,2),d=u[0],h=u[1],j=Object(S.a)((function(t){var n=Object(l.a)(t.args,1)[0],a=t.down,r=Object(l.a)(t.movement,2),c=r[0],o=r[1],i=Object(l.a)(t.offset,2),s=(i[0],i[1],Object(l.a)(t.initial,2)),u=s[0],d=s[1],j=u-n.x,b=d-n.y,m=u-n.x+c,g=d-n.y+o;m<0?m=0:m>n.width&&(m=n.width),g<0?g=0:g>n.height&&(g=n.height),h({startX:j,startY:b,endX:m,endY:g}),e.setSearchArgs({x:Math.min(j,m)/n.width,y:Math.min(b,g)/n.height,w:Math.abs(j-m)/n.width,h:Math.abs(b-g)/n.height}),e.setMouseDown(a)}),{threshold:10});return Object(a.jsxs)("div",Object(k.a)(Object(k.a)({className:t.root,ref:o},j(i)),{},{style:{touchAction:"none"},children:[Object(a.jsx)("img",{ref:e.sourceImgRef,id:"source_image",className:t.img,alt:"Loaded image",src:e.image}),Math.abs(d.startX-d.endX)*Math.abs(d.startY-d.endY)>0?Object(a.jsx)("div",{className:t.box,style:{width:Math.abs(d.startX-d.endX),height:Math.abs(d.startY-d.endY),left:Math.min(d.startX,d.endX),top:Math.min(d.startY,d.endY)},onClick:function(e){return console.log("clicked")}}):null]}))}var N=Object(M.a)({root:{position:"relative",display:"flex",flexDirection:"column"}});function B(e){var t=N();return Object(a.jsxs)("div",{className:t.root,children:[Object(a.jsx)("canvas",{id:"selected_portion",alt:"Selected portion of image"}),Object(a.jsx)("canvas",{id:"segmented_portion",alt:"Segmented portion of image"})]})}var D=n(19),F=n(242),X=n(241),Y=c.a.createContext();function z(){var e=c.a.useContext(Y);if(!e)throw new Error("useCount must be used within a DebugMsgProvider");return e}function L(e){var t=c.a.useState([]),n=Object(l.a)(t,2),r=n[0],o=n[1],i=c.a.useMemo((function(){return[r,o]}),[r]);return Object(a.jsx)(Y.Provider,Object(k.a)({value:i},e))}var R=c.a.createContext(),E=(R.Consumer,R.Provider),A=function(e){var t=e.modelName,n=e.quantizationBytes,c=void 0===n?2:n,o=e.children,i=Object(r.useState)(!1),s=Object(l.a)(i,2),h=s[0],j=s[1],b=Object(r.useState)(),m=Object(l.a)(b,2),g=m[0],f=m[1],p=z(),O=Object(l.a)(p,2),x=O[0],v=O[1],w=Object(r.useMemo)((function(){return{base:t,quantizationBytes:c}}),[t,c]),y=Object(r.useCallback)(function(){var e=Object(d.a)(u.a.mark((function e(t){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,X.load(t);case 3:n=e.sent,f(n),a="TF model loaded",v([].concat(Object(D.a)(x),[a])),console.log(a),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),[]);Object(r.useEffect)((function(){F.ready().then((function(){j(!0),y(w)}))}),[w,y]);var k=Object(r.useMemo)((function(){return{tfLoaded:h,tf:F,deeplab:X,model:g}}),[h,g]);return Object(a.jsx)(E,{value:k,children:o})},P=Object(M.a)({root:{display:"flex",alignItems:"center",gap:10}});function T(e){var t,n,o,i,s=P(),u=Object(r.useState)(!1),d=Object(l.a)(u,2),h=d[0],j=d[1],b=c.a.useContext(R),m=b.tfLoaded,g=b.tf,f=b.model,p=c.a.createRef(),O=null===(t=document)||void 0===t||null===(n=t.getElementById("source_image"))||void 0===n?void 0:n.width,x=null===(o=document)||void 0===o||null===(i=o.getElementById("source_image"))||void 0===i?void 0:i.height;return Object(r.useLayoutEffect)((function(){if(m&&g&&f&&e.image&&p.current&&!h&&O>0)try{console.log("sourceImgRef.current:",p.current);var t=g.browser.fromPixels(p.current),n=e.xywh,a=n.x,r=n.y,c=n.w,o=n.h;console.log("xywh:",e.xywh);var i=[[r,a,r+o,a+c]],s=[parseInt(x*o),parseInt(O*c)];console.log("cropSize (h,w):",s);var u=g.squeeze(g.image.cropAndResize(t.expandDims(0).toFloat(),i,[0],s,"bilinear"),0);console.log("croppedTensor.shape",u.shape);var d=document.getElementById("selected_portion");d.style.width="100%",d.style.height="100%";var l=s[0]/x/2;d.height=l*s[0],d.width=l*s[1],g.browser.toPixels(u.toInt(),d),f.segment(u).then((function(e){console.log("segment output",e);e.legend;var t=e.height,n=e.width,a=e.segmentationMap,r=document.getElementById("segmented_portion"),c=r.getContext("2d"),o=new ImageData(a,n,t);console.log("segmentationMapData:",o),r.style.width="100%",r.style.height="100%";var i=t/x/2;r.height=i*t,r.width=i*n,createImageBitmap(o).then((function(e){c.drawImage(e,0,0,n,t,0,0,r.width,r.height)}))}))}catch(j){console.error(j)}}),[m,f,e.image,p,h]),Object(a.jsxs)("div",{className:s.root,children:[Object(a.jsx)(_,Object(k.a)(Object(k.a)({},e),{},{sourceImgRef:p,setMouseDown:j})),Object(a.jsx)(B,{})]})}var q=n(322),W=n.n(q),J=function(e){return{authority:"api.pinterest.com","Content-Type":"multipart/form-data; boundary=".concat(e._boundary),accept:"*/*"}},U="https://cors-anywhere.herokuapp.com/";function G(){return(G=Object(d.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W()({method:"put",url:"".concat(U,"https://api.pinterest.com/v3/visual_search/extension/image/"),headers:J(t),data:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e){var t=Object(r.useState)(null),n=Object(l.a)(t,2),o=n[0],i=n[1],s=Object(r.useState)({x:0,y:0,w:1,h:1}),h=Object(l.a)(s,2),j=h[0],b=h[1],m=Object(r.useState)(!1),g=Object(l.a)(m,2),f=g[0],p=g[1],O=Object(r.useState)(!1),x=Object(l.a)(O,2),v=x[0],w=x[1],k=Object(r.useState)(null),S=Object(l.a)(k,2),C=S[0],M=S[1],I=c.a.createRef();return Object(a.jsxs)("div",{children:[Object(a.jsx)("input",{type:"file",id:"myfile",name:"myfile",ref:I,onChange:function(){var e=I.current.files[0],t=new FileReader;t.onloadstart=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:p(!0);case 1:case"end":return e.stop()}}),e)}))),t.onloadend=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i(t.result),p(!1);case 2:case"end":return e.stop()}}),e)}))),t.onerror=function(e){console.error(e),p(!1)},t.readAsDataURL(e)}}),f?Object(a.jsx)("div",{children:"...Loading"}):null,Object(a.jsx)("div",{children:o?Object(a.jsxs)("div",{children:[Object(a.jsx)(T,{image:o,xywh:j,setSearchArgs:b}),v?Object(a.jsx)("div",{children:"...Searching"}):Object(a.jsx)("button",{onClick:function(){var e=new FormData,t=I.current.files[0],n=function(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],a=atob(t[1]),r=a.length,c=new Uint8Array(r);r--;)c[r]=a.charCodeAt(r);return new Blob([c],{type:n})}(o);e.append("image",n,t.name),e.append("x",j.x.toString()),e.append("y",j.y.toString()),e.append("w",j.w.toString()),e.append("h",j.h.toString()),w(!0),function(e){return G.apply(this,arguments)}(e).then((function(e){M(e.data),w(!1)})).catch((function(e){w(!1)}))},children:"Search"})]}):Object(a.jsx)("div",{children:"No image"})}),Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{children:"Results:"}),(null===C||void 0===C?void 0:C.data)?Object(a.jsx)(y,{data:C.data}):null]})]})}var K=Object(M.a)({debug:{position:"fixed",backgroundColor:"rgb(0,0,255,0.5)",top:0,right:0,width:200}});function Q(e){var t=K(),n=z(),r=Object(l.a)(n,1)[0];return Object(a.jsx)("div",{className:t.debug,children:r.map((function(e,t){return Object(a.jsx)("div",{children:e},t)}))})}var V=!0;var Z=function(){return Object(a.jsx)(a.Fragment,{children:Object(a.jsxs)(L,{children:[Object(a.jsx)(A,{modelName:"pascal",quantizationBytes:2,children:Object(a.jsx)(H,{})}),V?Object(a.jsx)(Q,{}):null]})})},$=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,420)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),a(e),r(e),c(e),o(e)}))};i.a.render(Object(a.jsx)(c.a.StrictMode,{children:Object(a.jsx)(Z,{})}),document.getElementById("root")),$()}},[[397,1,2]]]);
//# sourceMappingURL=main.dd458dbe.chunk.js.map